#!/bin/sh

set -e
set -x

apt-get update

# These are required by tests:
#
# cryptsetup
# debootstrap
# e2fsprogs
# yum
# zypper

env DEBIAN_FRONTEND=noninteractive apt-get install -f -y --no-install-recommends \
	build-essential                                                          \
	ca-certificates                                                          \
	cryptsetup                                                               \
	curl                                                                     \
	debootstrap                                                              \
	e2fsprogs                                                                \
	git                                                                      \
	libgpgme11-dev                                                           \
	libseccomp-dev                                                           \
	libssl-dev                                                               \
	pkg-config                                                               \
	squashfs-tools                                                           \
	sudo                                                                     \
	uuid-dev                                                                 \
	yum                                                                      \
	zypper

apt-get clean

rm -rf /var/lib/apt/lists/*

curl --location https://github.com/gotestyourself/gotestsum/releases/download/v0.3.5/gotestsum_0.3.5_linux_amd64.tar.gz |
	tar -xOzf - gotestsum > /usr/bin/gotestsum

chown root:root /usr/bin/gotestsum

chmod 0755 /usr/bin/gotestsum

echo 'ALL ALL=(ALL:ALL) NOPASSWD:ALL' > /etc/sudoers
